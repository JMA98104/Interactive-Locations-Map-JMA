<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Locations | Jackson Main Architecture</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="container">
    <h1 class="page-title">Project Locations</h1>
    
    <!-- Toggle Button -->
    <div class="toggle-wrapper">
      <button id="toggleLocations" class="toggle-button">▲</button>
    </div>

    <!-- Project Locations Wrapper (Collapsible) -->
    <div id="projectLocationsWrapper" style="display: block;">
      <p class="project-count">
        <strong>Total Projects Found:</strong> <span id="totalProjects">Loading...</span>
      </p>

      <div class="table-container">
        <table id="projectsTable">
          <thead>
            <tr>
              <th>Project Name</th>
              <th>Sector</th>
              <th>Projects</th>
            </tr>
          </thead>
          <tbody id="projectList">
            <!-- Dynamically populated rows -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Map Container -->
    <div id="map" style="width: 100%; height: 600px; margin-top: 40px;"></div>
  </div>

  <!-- ✅ Lazy Load Scripts -->
  <script>
    let mapLoaded = false;

    function lazyLoadMap() {
      if (!mapLoaded) {
        mapLoaded = true;

        // Google Maps API
        const gmaps = document.createElement('script');
        gmaps.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDIfZAl4HpvdM02gciIlthJBfoV6CnDd2E&callback=initMap";
        gmaps.async = true;
        gmaps.defer = true;
        document.head.appendChild(gmaps);

        // MarkerClusterer (modern version)
        const cluster = document.createElement('script');
        cluster.src = "https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js";
        cluster.async = true;
        document.head.appendChild(cluster);

        // Locations data
        const locationsScript = document.createElement('script');
        locationsScript.src = "locations.js";
        document.head.appendChild(locationsScript);

        // Main map logic
        const mapScript = document.createElement('script');
        mapScript.src = "map.js";
        document.head.appendChild(mapScript);
      }
    }

    // Intersection observer for lazy loading
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          lazyLoadMap();
          observer.disconnect();
        }
      });
    }, { threshold: 0.1 });

    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', function () {
      const mapEl = document.getElementById('map');
      if (mapEl) observer.observe(mapEl);

      // Table toggle
      const toggleBtn = document.getElementById('toggleLocations');
      if (toggleBtn) {
        toggleBtn.addEventListener('click', function () {
          const wrapper = document.getElementById('projectLocationsWrapper');
          if (wrapper.style.display === 'none') {
            wrapper.style.display = 'block';
            this.innerHTML = '▲';
          } else {
            wrapper.style.display = 'none';
            this.innerHTML = '▼';
          }
        });
      }
    });
  </script>
</body>
</html>

